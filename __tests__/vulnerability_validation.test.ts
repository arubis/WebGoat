

import { describe, it, expect } from 'vitest';
import path from 'path';
import fs from 'fs';

describe('SQL Injection via XML Construction', () => {
  it('should sanitize user input before embedding in XML for SQL queries', () => {
    // Load the source code
    const sourceCode = fs.readFileSync(
      path.join(process.cwd(), 'src/main/resources/webgoat/static/js/goatApp/support/CustomGoat.js'),
      'utf8'
    );
    
    // RED TEST: Check if security controls exist in the source
    // This FAILS on vulnerable code because no XML escaping/sanitization is present
    // Secure code would have XML escaping like escapeXml(), encodeXML(), _.escape(), or sanitize()
    expect(sourceCode).toMatch(/escapeXml|encodeXML|_.escape|sanitize|htmlEntities/);
  });
});