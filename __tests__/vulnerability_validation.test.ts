

describe('security', () => {
it('security_sql_injection_approach_1', () => {
  // Attack vector: sql_injection
    import { describe, it, expect } from 'vitest';
  import { vi } from 'vitest';
  import path from 'path';

  describe('SQL Injection Prevention - CustomGoat.getFlights()', () => {
    it('should sanitize user input before embedding in XML', () => {
      const sqlInjectionPayload = "' OR '1'='1";
      
      const mockFromField = {
        value: vi.fn().mockReturnValue(sqlInjectionPayload)
      };
      
      const mockToField = {
        value: vi.fn().mockReturnValue('destination')
      };
      
      global.$ = vi.fn((selector) => {
        if (selector === '#travelFrom') return mockFromField;
        if (selector === '#travelTo') return mockToField;
        return { value: vi.fn() };
      });
      
      let customGoat;
      const mockDefine = vi.fn((deps, factory) => {
        customGoat = factory(global.$, {}, {}, {});
      });
      global.define = mockDefine;
      global.define.amd = true;
      
      const sourceCode = `define(['jquery',
      'underscore',
      'backbone',
      'libs/jquery.form'
      ],
      function($,
        _,
        Backbone,
        JQueryForm) {
          var customGoat = {

                  getFlights:function() {
                      var fromField = $('#travelFrom');
                      var toField = $('#travelTo');
                      var xml = '<?xml version="1.0"?>' +
                          '<searchForm>' +
                          '  <from>' + fromField.value() + '</from>' +
                          '</searchForm>';
                      return xml;
                  },
              }

              return customGoat;
      });`;
      
      eval(sourceCode);
      
      const result = customGoat.getFlights();
      
      expect(result).not.toContain("' OR '1'='1");
    });
  });
});

});
